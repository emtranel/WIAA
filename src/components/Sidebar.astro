---
const base = import.meta.env.BASE_URL.replace(/\/$/, '');

interface Props {
  currentChapter: number;
  currentLesson?: number;
}

const { currentChapter, currentLesson } = Astro.props;

const chapters = [
  {
    num: 1,
    title: "Learning goals",
    lessons: [
      { num: 1, title: "Learning objectives", href: base + "/drones/01-learning-goals/lesson-1" },
      { num: 2, title: "Next generation science standards", href: base + "/drones/01-learning-goals/lesson-2" }
    ]
  },
  {
    num: 2,
    title: "Introduction to drones",
    lessons: [
      { num: 1, title: "What is a Drone?", href: base + "/drones/02-introduction/lesson-1" },
      { num: 2, title: "Agricultural Applications", href: base + "/drones/02-introduction/lesson-2" },
      { num: 3, title: "Concept review", href: base + "/drones/02-introduction/review" }
    ]
  },
  {
    num: 3,
    title: "Drone parts & types",
    lessons: [
      { num: 1, title: "Main Components", href: base + "/drones/03-parts-types/lesson-1" },
      { num: 2, title: "Types of Agricultural Drones", href: base + "/drones/03-parts-types/lesson-2" },
      { num: 3, title: "Concept review", href: base + "/drones/03-parts-types/review" }
    ]
  },
  {
    num: 4,
    title: "Sensors & data collection",
    lessons: [
      { num: 1, title: "Types of agricultural sensors", href: base + "/drones/04-sensors/lesson-1" },
      { num: 2, title: "Reflectance and plant health", href: base + "/drones/04-sensors/lesson-2" },
      { num: 3, title: "Vegetation indices", href: base + "/drones/04-sensors/lesson-3" },
      { num: 4, title: "Concept review", href: base + "/drones/04-sensors/review" }
    ]
  },
  {
    num: 5,
    title: "AI in agriculture",
    lessons: [
      { num: 1, title: "What is AI?", href: base + "/drones/05-ai-agriculture/lesson-1" },
      { num: 2, title: "AI tools in agriculture", href: base + "/drones/05-ai-agriculture/lesson-2" },
      { num: 3, title: "How AI models are developed", href: base + "/drones/05-ai-agriculture/lesson-3" },
      { num: 4, title: "Concept review", href: base + "/drones/05-ai-agriculture/review" }
    ]
  },
  {
    num: 6,
    title: "FAA Part 107 & safety",
    lessons: [
      { num: 1, title: "FAA Basics & Requirements", href: base + "/drones/06-faa-safety/lesson-1" },
      { num: 2, title: "Core flight rules & regulations", href: base + "/drones/06-faa-safety/lesson-2" },
      { num: 3, title: "Concept review", href: base + "/drones/06-faa-safety/review" }
    ]
  },
  {
    num: 7,
    title: "Careers in drones & AI",
    lessons: [
      { num: 1, title: "Why these skills matter", href: base + "/drones/07-careers/lesson-1" },
      { num: 2, title: "Skills you can build now", href: base + "/drones/07-careers/lesson-2" },
      { num: 3, title: "Concept review", href: base + "/drones/07-careers/review" }
    ]
  },
  {
    num: 8,
    title: "References",
    lessons: [
      { num: 1, title: "References", href: base + "/drones/08-references/lesson-1" }
    ]
  }
];
---

<aside class="sidebar">
  <h3>Content</h3>
  <nav class="chapter-nav">
    {chapters.map(chapter => (
      <div class="chapter-section">
        <a
          href={chapter.lessons[0].href}
          class={`chapter-btn ${currentChapter === chapter.num ? 'active' : ''}`}
        >
          {chapter.title}
        </a>
        {currentChapter === chapter.num && (
          <div class="lesson-list">
            {chapter.lessons.map(lesson => (
              <a
                href={lesson.href}
                class={`lesson-btn ${currentLesson === lesson.num ? 'active' : ''}`}
              >
                {lesson.title}
              </a>
            ))}
          </div>
        )}
      </div>
    ))}
  </nav>
</aside>

<style>
  .sidebar {
    background: white;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid var(--border-light);
    height: fit-content;
    width: 250px;
  }

  .sidebar h3 {
    margin-bottom: 15px;
    color: var(--isu-red);
    font-size: 1.1em;
    border-bottom: 2px solid var(--isu-gold);
    padding-bottom: 10px;
  }

  .chapter-nav {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }

  .chapter-btn {
    display: block;
    padding: 8px 10px;
    background: var(--isu-red);
    color: white;
    border: none;
    border-radius: 4px;
    text-align: left;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
    text-decoration: none;
    font-size: 0.9em;
  }

  .chapter-btn:hover {
    background: var(--isu-dark-red);
  }

  .chapter-btn.active {
    background: var(--isu-dark-red);
  }

  .lesson-list {
    display: flex;
    flex-direction: column;
    gap: 5px;
    margin-top: 5px;
  }

  .lesson-btn {
    display: block;
    padding: 6px 10px;
    margin-left: 10px;
    background: white;
    color: var(--text-medium);
    border: 1px solid #ddd;
    border-radius: 4px;
    text-align: left;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    font-size: 0.85em;
  }

  .lesson-btn:hover {
    border-color: var(--isu-red);
    color: var(--isu-red);
    background: rgba(196, 30, 58, 0.05);
  }

  .lesson-btn.active {
    background: rgba(196, 30, 58, 0.1);
    border-color: var(--isu-red);
    color: var(--isu-red);
    font-weight: 600;
  }
</style>